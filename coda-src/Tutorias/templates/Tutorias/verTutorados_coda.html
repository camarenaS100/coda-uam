{% extends "Usuarios/HeaderAndFooterFachada.html"%}

{% block title %} Lista de tutorados {% endblock %}


{% block body %}
<section class="min-vh-100" style="background-color: #eee;">
  <div class="container py-5 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
          <div class="col-lg-8 col-xl-10">
              <div class="card border-top border-bottom border-4" style="border-color: #F08200 !important;">
                  <div class="card-body p-4">
                      <h3 class="fw-bold mb-5 text-primary">Tutorados de: {{tutor.first_name}} {{tutor.last_name}}</h3>
                      
                      <!-- Submit button -->
                      <a href="{% url 'Reporte-create' tutor.pk %}">Generar carta de notificación</a>
                      <br>
                      <!-- Borrar esta parte y todo lo relacionado a esta vista/url, etc-->
                      <div class="d-grid gap-2 d-md-flex justify-content-center">
                        <form action="{% url 'tutorados_pdf' %}" method="get">
                          <input type="hidden" value="{{tutor.matricula}}" name="tutor-id">
                          <button type="submit" class="btn btn-primary">Generar carta</button>
                        </form>
                      </div>
                      
                      <!--Inicio de table-->
                      <div class = "table-responsive">
                        <a onclick="submitSelected()" href="#">Generar carta de notificación de tutor</a>
                        <table class="table table-striped table-hover">
                          <thead>
                            <tr>
                              <th><input type="checkbox" name="sample" id="select-all"/></th>
                              <th>Nombre</th>
                              <th>Correo</th>
                              <th>Correo personal</th>
                              <th>Matrícula</th>
                              <th>Carrera</th>
                              
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                            {% for alumno in object_list %}
                            <tr>
                              <td><input type="checkbox" class="item-checkbox" value="{{alumno.pk}}"></td>
                              <td>{{ alumno.first_name }} {{ alumno.last_name }}</td>
                              <td>{{ alumno.email}} </td>
                              <td>{{ alumno.correo_personal|default_if_none:"No registrado" }}</td>
                              <td>{{ alumno.matricula }} </td>
                              <td>{{ alumno.get_carrera_display }}</td>
                              
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      <!--Fin de table-->
                  </div>
              </div>
          </div>
      </div>
  </div>
</section>

<script>
  const selectAllCheckbox = document.getElementById('select-all');
  const itemCheckboxes = document.querySelectorAll('.item-checkbox');

  console.log(itemCheckboxes);
  console.log(selectAllCheckbox);
  selectAllCheckbox.addEventListener('change', function () {
      itemCheckboxes.forEach(checkbox => {
          checkbox.checked = selectAllCheckbox.checked;
      });
  });

  function submitSelected() {
      let selectedCheckboxes = document.querySelectorAll('.item-checkbox:checked');
      let selectedIDs = Array.from(selectedCheckboxes).map(cb => cb.value);

      if (selectedIDs.length === 0) {
          alert("Por favor, seleccione al menos un alumno.");
          return;
      }

      // Convert selected student IDs to query parameters
      let queryString = selectedIDs.map(id => `selected_alumnos=${id}`).join("&");
      console.log(queryString)

      // Redirect to Reporte2-create with selected student IDs
      window.location.href = `{% url 'Reporte2-create' tutor.pk %}?` + queryString;
  }
</script>

{% endblock %}